<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Principles of operation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Principles of operation ">
    <meta name="generator" content="docfx 2.59.1.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../content/index.html" width="46">
                <img id="logo" src="../../content/main/shared-content/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="PIAdapterForMQTTPrinciplesOfOperation">
<h1 id="principles-of-operation">Principles of operation</h1>

<p>This adapter&#39;s operations focus on data collection and stream creation.</p>
<h2 id="adapter-configuration">Adapter configuration</h2>
<p>To start data collection for the MQTT adapter, configure the following:</p>
<ul>
<li>Data source: Provide the data source from which the adapter should collect data.<br> For more details, see the data source topics <a class="xref" href="../configuration/data-source-generic.html">PI Adapter for MQTT data source configuration</a> and <a class="xref" href="../configuration/data-source-sparkplug-b.html">PI Adapter for MQTT Sparkplug B data source configuration</a>.</li>
<li>Data selection: Select MQTT items to which the adapter should subscribe for data. <br> For more details, see the data selection topics <a class="xref" href="../configuration/data-selection-generic.html">PI Adapter for MQTT data selection configuration</a> and <a class="xref" href="../configuration/data-selection-sparkplug-b.html">PI Adapter for MQTT Sparkplug B data selection configuration</a>.</li>
<li>Logging: Set up the logging attributes to manage the adapter logging behavior.</li>
</ul>
<h2 id="connection">Connection</h2>
<p>The adapter uses either the Transmission Control Protocol (TCP) or WebSocket protocol (WS) to speak to an MQTT server. For more information on how to configure which protocol should be used, see <a class="xref" href="../configuration/data-source-generic.html">PI Adapter for MQTT data source configuration</a> and <a class="xref" href="../configuration/data-source-sparkplug-b.html">PI Adapter for MQTT Sparkplug B data source configuration</a>.</p>
<h2 id="data-collection">Data collection</h2>
<p>The adapter collects time-series data from the MQTT server using Topics. The generic MQTT adapter only supports data from devices producing JSON payload, the MQTT Sparkplug B adapter also supports data from devices adhering to the Sparkplug B specification. For more information see <a class="xref" href="../configuration/data-selection-generic.html">PI Adapter for MQTT data selection configuration</a> and <a class="xref" href="../configuration/data-selection-sparkplug-b.html">PI Adapter for MQTT Sparkplug B data selection configuration</a>.</p>
<h3 id="data-types">Data types</h3>
<p>The following sections list both MQTT generic and MQTT Sparkplug B data types and their respective stream data types.</p>
<h4 id="mqtt-data-types">MQTT data types</h4>
<p>The following table lists MQTT variable types that the adapter collects data from and the types of streams that will be created.</p>
<table>
<thead>
<tr>
<th>MQTT data type</th>
<th>Stream data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Int16</td>
<td>Int16</td>
</tr>
<tr>
<td>Int32</td>
<td>Int32</td>
</tr>
<tr>
<td>Int64</td>
<td>Int64</td>
</tr>
<tr>
<td>UInt16</td>
<td>UInt16</td>
</tr>
<tr>
<td>UInt32</td>
<td>UInt32</td>
</tr>
<tr>
<td>UInt64</td>
<td>UInt64</td>
</tr>
<tr>
<td>Float32</td>
<td>Float32</td>
</tr>
<tr>
<td>Float64</td>
<td>Float64</td>
</tr>
<tr>
<td>Boolean</td>
<td>Boolean</td>
</tr>
<tr>
<td>String</td>
<td>String</td>
</tr>
<tr>
<td>Date-Time</td>
<td>Date-Time</td>
</tr>
</tbody>
</table>
<p>The following table lists MQTT complex types that the adapter collects data from and the type of streams that will be created.</p>
<table>
<thead>
<tr>
<th>MQTT complex type</th>
<th>Stream data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Geolocation</td>
<td>Float32</td>
</tr>
<tr>
<td>Coordinates</td>
<td>Float32</td>
</tr>
</tbody>
</table>
<h4 id="mqtt-sparkplug-b-data-types">MQTT Sparkplug B data types</h4>
<p>The following table lists MQTT Sparkplug B variable types that the adapter collects data from and the types of streams that will be created.</p>
<table>
<thead>
<tr>
<th>MQTT Sparkplug B data type</th>
<th>Stream data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Int8</td>
<td>Int8</td>
</tr>
<tr>
<td>Int16</td>
<td>Int16</td>
</tr>
<tr>
<td>Int32</td>
<td>Int32</td>
</tr>
<tr>
<td>Int64</td>
<td>Int64</td>
</tr>
<tr>
<td>UInt8</td>
<td>UInt8</td>
</tr>
<tr>
<td>UInt16</td>
<td>UInt16</td>
</tr>
<tr>
<td>UInt32</td>
<td>UInt32</td>
</tr>
<tr>
<td>UInt64</td>
<td>UInt64</td>
</tr>
<tr>
<td>Float</td>
<td>Float32</td>
</tr>
<tr>
<td>Double</td>
<td>Float64</td>
</tr>
<tr>
<td>Boolean</td>
<td>Boolean</td>
</tr>
<tr>
<td>String</td>
<td>String</td>
</tr>
<tr>
<td>DateTime</td>
<td>UInt64</td>
</tr>
<tr>
<td>Text</td>
<td>String</td>
</tr>
</tbody>
</table>
<h2 id="stream-creation">Stream creation</h2>
<p>The MQTT adapter creates a stream with two properties for each selected MQTT item. The properties are described in the following table.</p>
<table>
<thead>
<tr>
<th>Property name</th>
<th>Data type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Timestamp</code></td>
<td>String</td>
<td>The response time of the stream data from the MQTT device</td>
</tr>
<tr>
<td><code>Value</code></td>
<td>Specified by the data selection</td>
<td>The value of the stream data from the MQTT device</td>
</tr>
</tbody>
</table>
<p>Certain metadata are sent with each stream created. The following metadata are common for every adapter type:</p>
<ul>
<li><strong>ComponentId</strong>: Specifies the data source, for example, <em>MQTT1</em></li>
<li><strong>ComponentType</strong>: Specifies the type of adapter, for example, <em>MQTT</em></li>
</ul>
<h3 id="mqtt-specific-metadata">MQTT specific metadata</h3>
<p>Metadata specific to the MQTT generic component are:</p>
<ul>
<li><strong>Topic</strong>: Specifies the MQTT topic string</li>
<li><strong>ValueField</strong>: Specifies the JsonPath expression used to extract the data value from a property within the payload supplied by the MQTT server</li>
</ul>
<p><strong>Note:</strong> A configured metadata level allows you to set the amount of metadata for the adapter. Specify the metadata level in <a class="xref" href="../main/shared-content/configuration/diagnostics-and-metadata.html">General configuration</a>. For the MQTT adapter, the following metadata are sent for the individual level:</p>
<ul>
<li><code>None</code>: No metadata</li>
<li><code>Low</code>: AdapterType (ComponentType) and DataSource (ComponentId)</li>
<li><code>Medium</code>: AdapterType (ComponentType), DataSource (ComponentId), Topic, and ValueField or DataFields</li>
</ul>
<p>Each stream created for the selected measurement has a unique identifier (stream Id). If you specify a custom stream Id for the measurement in the data selection configuration, the adapter uses that stream Id to create the stream. Otherwise, the adapter constructs the stream Id using the following format:</p>
<pre><code class="lang-code">&lt;AdapterComponentId&gt;.&lt;Topic&gt;.&lt;ValueField&gt;
</code></pre><p><strong>Note:</strong> <code>StreamIdPrefix</code> and <code>DefaultStreamIdPattern</code> settings in the data source configuration affect the naming convention. For more information, see <a class="xref" href="../configuration/data-source-generic.html">PI Adapter for MQTT data source configuration</a>.</p>
<h3 id="mqtt-sparkplug-b-specific-metadata">MQTT Sparkplug B specific metadata</h3>
<p>Metadata specific to the MQTT Sparkplug B component are:</p>
<ul>
<li><strong>Namespace</strong>: Specifies the topic namespace</li>
<li><strong>Group_Id</strong>: Specifies the element of the topic namespace that logically groups MQTT EoN<sup>1</sup> nodes into the MQTT server and the consuming MQTT clients</li>
<li><strong>Edge_Node_Id</strong>: Specifies the element of the topic namespace that uniquely identifies the MQTT EoN<sup>1</sup> node within the infrastructure</li>
<li><strong>Device_Id</strong>: Specifies the element of the topic namespace that identifies a device attached to the MQTT EoN<sup>1</sup> node</li>
</ul>
<p><sup>1</sup> EoN = Edge of Network</p>
<p><strong>Note:</strong> A configured metadata level allows you to set the amount of metadata for the adapter. Specify the metadata level in <a class="xref" href="../main/shared-content/configuration/diagnostics-and-metadata.html">General configuration</a>. For the MQTT adapter, the following metadata are sent for the individual level:</p>
<ul>
<li><code>None</code>: No metadata</li>
<li><code>Low</code>: AdapterType (ComponentType) and DataSource (ComponentId)</li>
<li><code>Medium</code>: AdapterType (ComponentType), DataSource (ComponentId), Topic, and MetricName</li>
</ul>
<p>Each stream created for the selected measurement has a unique identifier (stream Id). If you specify a custom stream Id for the measurement in the data selection configuration, the adapter uses that stream Id to create the stream. Otherwise, the adapter constructs the stream Id using the following format:</p>
<pre><code class="lang-code">&lt;AdapterComponentId&gt;.&lt;BaseTopic&gt;.&lt;MetricName&gt;
</code></pre><p><strong>Note:</strong> <code>StreamIdPrefix</code> and <code>DefaultStreamIdPattern</code> settings in the data source configuration affect the naming convention. For more information, see <a class="xref" href="../configuration/data-source-sparkplug-b.html">PI Adapter for MQTT Sparkplug B data source configuration</a>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/PI-Adapter-MQTT-Docs/blob/main/content/overview/principles-of-operation.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span><a href="https://www.osisoft.com/copyright/">© 2019 - 2021 OSIsoft, LLC. All rights reserved.</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
