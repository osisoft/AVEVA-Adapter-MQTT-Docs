<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Data source (generic) </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Data source (generic) ">
    <meta name="generator" content="docfx 2.59.1.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../content/index.html" width="46">
                <img id="logo" src="../../content/main/shared-content/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="PIAdapterForMQTTDataSourceConfiguration">
<h1 id="data-source-generic">Data source (generic)</h1>

<p>To use the adapter, you must configure the data source from which it polls data.</p>
<h2 id="configure-mqtt-data-source">Configure MQTT data source</h2>
<p>Complete the following steps to configure an MQTT data source. Use the <code>PUT</code> method in conjunction with the <code>api/v1/configuration/&lt;ComponentId&gt;/DataSource</code> REST endpoint to initialize the configuration.</p>
<ol>
<li><p>Using a text editor, create an empty text file.</p>
</li>
<li><p>Copy and paste an example configuration for an MQTT data source into the file.</p>
<p> For sample JSON, see <a href="#mqtt-data-source-examples">MQTT data source examples</a>.</p>
</li>
<li><p>Update the example JSON parameters for your environment.</p>
<p> For a table of all available parameters, see <a href="#mqtt-data-source-parameters">MQTT data source parameters</a>.</p>
</li>
<li><p>Save the file. For example, as <code>ConfigureDataSource.json</code>.</p>
</li>
<li><p>Open a command line session. Change directory to the location of <code>ConfigureDataSource.json</code>.</p>
</li>
<li><p>Enter the following cURL command (which uses the <code>PUT</code> method) to initialize the data source configuration.</p>
<pre><code class="lang-bash">curl -d &quot;@ConfigureDataSource.json&quot; -H &quot;Content-Type: application/json&quot; -X PUT &quot;http://localhost:5590/api/v1/configuration/MQTT1/DataSource&quot;
</code></pre><p> <strong>Notes:</strong></p>
<ul>
<li>If you installed the adapter to listen on a non-default port, update <code>5590</code> to the port number in use.</li>
<li>If you use a component ID other than <code>MQTT1</code>, update the endpoint with your chosen component ID.</li>
<li>For a list of other REST operations you can perform, like updating or deleting a data source configuration, see <a href="#rest-urls">REST URLs</a>.
<br>
<br></li>
</ul>
</li>
<li><p>Configure data selection.</p>
<p> For more information, see <a class="xref" href="data-selection-generic.html">PI Adapter for MQTT data selection configuration</a>.</p>
</li>
</ol>
<h2 id="mqtt-data-source-schema">MQTT data source schema</h2>
<p>The full schema definition for the MQTT data source configuration is in the <code>MQTT_DataSource_schema.json</code> file located in one of the following folders:</p>
<ul>
<li>Windows: <code>%ProgramFiles%\OSIsoft\Adapters\MQTT\Schemas</code></li>
<li>Linux: <code>/opt/OSIsoft/Adapters/MQTT/Schemas</code></li>
</ul>
<h2 id="mqtt-data-source-parameters">MQTT data source parameters</h2>
<p>The following parameters are available for configuring an MQTT data source:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>HostNameOrIpAddress</strong></td>
<td>Required</td>
<td><code>string</code></td>
<td>Host name or IP address of the MQTT server  <br><br>Allowed value: Any valid WS or TCP/IP endpoint address <br> Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>Port</strong></td>
<td>Optional</td>
<td><code>integer</code></td>
<td>Port number of the MQTT  server. Required only if <strong>Protocol</strong> is TCP. <br><br>Allowed value: Valid port range or null <br> Default value if <strong>Protocol</strong> is TCP: <code>8883</code> <br> Default value if <strong>Protocol</strong> is WS: <code>null</code></td>
</tr>
<tr>
<td><strong>Protocol</strong></td>
<td>Optional</td>
<td><code>enum</code></td>
<td>The protocol used to communicate to the MQTT broker <br><br>Allowed value: <code>WS</code> or <code>TCP</code> <br> Default value: <code>TCP</code></td>
</tr>
<tr>
<td><strong>TLS</strong></td>
<td>Optional</td>
<td><code>enum</code></td>
<td>Determines if TLS should be used and what version <br><br>Allowed value: <code>None</code>, <code>TLS</code>, <code>TLS11</code>, <code>TLS12</code>, <code>TLS13</code> <br> Default value: <code>TLS12</code></td>
</tr>
<tr>
<td><strong>UserName</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>User name or client Id for accessing the MQTT server <br><br>Allowed value: any string <br> Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>Password</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>Password or token for accessing the MQTT server <br><br><strong>Note:</strong> OSIsoft recommends using REST to configure the data source when the password must be specified because the adapter will encrypt the password when using REST. If you do not use REST, the plain text password is stored on-disk. You cannot specify a Password without specifying a UserName. <br><br>Allowed value: Any string <br> Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>ClientId</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>Unique identification of the adapter component connecting to the MQTT broker<br><br> <strong>Note:</strong> If the ClientId is null, the adapter generates a GUID.</td>
</tr>
<tr>
<td><strong>MQTTVersion</strong></td>
<td>Optional</td>
<td><code>enum</code></td>
<td>Version  of the MQTT protocol to be used  <br><br>Allowed value: <code>3.1.0</code>, or <code>3.1.1</code>, or <code>5.0.0</code> <br> Default value: <code>3.1.1</code></td>
</tr>
<tr>
<td><strong>ValidateServerCertificate</strong></td>
<td>Optional</td>
<td><code>boolean</code></td>
<td>Determines if the server certificate gets validated <br><br><strong>Note:</strong> A warning is printed in case the server certificate validation is disabled.<br> Default value: <code>true</code></td>
</tr>
<tr>
<td><strong>StreamIdPrefix</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>Specifies what prefix is used for stream Ids. The naming convention is <code>{StreamIdPrefix}{StreamId}</code>. An empty string means no prefix is added to the stream Ids and names. A <code>null</code> value defaults to <em>ComponentId</em> followed by a period.<br><br>Example: <code>Mqtt1.{Topic}.{ValueField}</code><br><br><strong>Note:</strong> Every time you change the StreamIdPrefix of a configured adapter, for example when you delete and add a data source, you need to restart the adapter for the changes to take place. New streams are created on adapter restart and pre-existing streams are no longer updated. <br><br>Allowed value: Any string <br> Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>DefaultStreamIdPattern</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>Specifies the default stream Id pattern to use. Possible parameters: <code>{Topic}</code>, <code>{ValueField}</code>, <code>{DataType}</code>. <br><br>Allowed value: Any string<br>Default value: <code>{Topic}.{ValueField}</code></td>
</tr>
<tr>
<td><strong>TimeZone</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>Specifies the time zone associated with data received from the configured MQTT broker and its topics.<br><br>Allowed value: A valid entry from the IANA time zone database, for example <code>America/Los_Angeles</code>, <code>Asia/Hong_Kong</code>, <code>Europe/London</code>, etc. For more information, see <a href="https://www.iana.org/time-zones">IANA Time Zone Database</a><br>Default value: <code>null</code><br><br><strong>Note:</strong> Supply this field if you are using source timestamps and the timestamp does not contain time zone information.</td>
</tr>
</tbody>
</table>
<h2 id="runtime-changes">Runtime changes</h2>
<p>When you set up a new data source configuration, the adapter automatically connects to the new data source. When you delete a data source configuration, the adapter automatically disconnects from the data source and stops data collection for all streams associated with that data source. Additionally, when you update existing data source properties, the changes are reflected at runtime.</p>
<p><strong>Note:</strong> Runtime changes also handle validation of configuration, which means that an invalid data source configuration is rejected.</p>
<h2 id="mqtt-data-source-examples">MQTT data source examples</h2>
<p>The following are examples of valid MQTT data source configurations:</p>
<h3 id="minimal-data-source-configuration">Minimal data source configuration</h3>
<pre><code class="lang-json">{
    &quot;HostNameOrIpAddress&quot; : &quot;125.0.0.0&quot; ,
    &quot;Port&quot; : 8765
}
</code></pre><h3 id="complete-data-source-configuration">Complete data source configuration</h3>
<pre><code class="lang-json">{
    &quot;StreamIdPrefix&quot; : null,
    &quot;DefaultStreamIdPattern&quot; : &quot;{Topic}.{ValueField}&quot;,
    &quot;HostNameOrIpAddress&quot; : &quot;125.0.0.0&quot;,
    &quot;Port&quot; : 8765,
    &quot;Protocol&quot; : &quot;Tcp&quot;,
    &quot;TLS&quot; : &quot;Tls12&quot;,
    &quot;UserName&quot;: null,
    &quot;Password&quot;: null,
    &quot;ClientId&quot; : &quot;Test-Client-Id&quot;,
    &quot;MQTTVersion&quot; : &quot;3.1.1&quot;,
    &quot;ValidateServerCertificate&quot; : true,
    &quot;timeZone&quot;: &quot;UTC&quot;,
    &quot;streamIdPrefix&quot;: &quot;MyPrefix.&quot;,
    &quot;defaultStreamIdPattern&quot;: &quot;{Topic}.{ValueField}&quot;
}
</code></pre><h2 id="rest-urls">REST URLs</h2>
<table>
<thead>
<tr>
<th>Relative URL</th>
<th>HTTP verb</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSource</td>
<td><code>GET</code></td>
<td>Retrieves the MQTT data source configuration.</td>
</tr>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSource</td>
<td><code>POST</code></td>
<td>Creates the MQTT data source configuration. The adapter starts collecting data after the following conditions are met:<br><br>&bull; The MQTT data source configuration <code>POST</code> request is received.<br>&bull; A MQTT data selection configuration is active.</td>
</tr>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSource</td>
<td><code>PUT</code></td>
<td>Configures or updates the MQTT data source configuration. Overwrites any active MQTT data source configuration. If no configuration is active, the adapter starts collecting data after the following conditions are met:<br><br>&bull; The MQTT data source configuration <code>PUT</code> request is received.<br>&bull; A MQTT data selection configuration is active.</td>
</tr>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSource</td>
<td><code>DELETE</code></td>
<td>Deletes the MQTT data source configuration. After the request is received, the adapter stops collecting data.</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Replace &lt;ComponentId> with the Id of your MQTT component. For example, <em>Mqtt1</em>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/PI-Adapter-MQTT-Docs/blob/main/content/configuration/data-source-generic.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span><a href="https://www.osisoft.com/copyright/">© 2019 - 2021 OSIsoft, LLC. All rights reserved.</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
