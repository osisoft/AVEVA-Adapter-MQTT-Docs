<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Data selection (generic) </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Data selection (generic) ">
    <meta name="generator" content="docfx 2.59.1.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../content/index.html" width="46">
                <img id="logo" src="../../content/main/shared-content/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="PIAdapterForMQTTDataSelectionConfiguration">
<h1 id="data-selection-generic">Data selection (generic)</h1>

<p>In addition to the data source configuration, you need to provide a data selection configuration to specify the data you want the adapter to collect from the data sources.</p>
<h2 id="configure-mqtt-data-selection">Configure MQTT data selection</h2>
<p>Complete the following steps to configure an MQTT data selection. Use the <code>PUT</code> method in conjunction with the <code>api/v1/configuration/&lt;ComponentId&gt;/DataSelection</code> REST endpoint to initialize the configuration.</p>
<ol>
<li><p>Using a text editor, create an empty text file.</p>
</li>
<li><p>Copy and paste an example configuration for an MQTT data selection into the file.</p>
<p> For sample JSON, see <a href="#mqtt-data-selection-examples">MQTT data selection examples</a>.</p>
</li>
<li><p>Update the example JSON parameters for your environment.</p>
<p> For a table of all available parameters, see <a href="#mqtt-data-selection-parameters">MQTT data selection parameters</a>.</p>
</li>
<li><p>Save the file. For example, as <code>ConfigureDataSelection.json</code>.</p>
</li>
<li><p>Open a command line session. Change directory to the location of <code>ConfigureDataSelection.json</code>.</p>
</li>
<li><p>Enter the following cURL command (which uses the <code>PUT</code> method) to initialize the data selection configuration.</p>
<pre><code class="lang-bash">curl -d &quot;@ConfigureDataSelection.json&quot; -H &quot;Content-Type: application/json&quot; -X PUT &quot;http://localhost:5590/api/v1/configuration/MQTT1/DataSelection&quot;
</code></pre><p> <strong>Notes:</strong></p>
<ul>
<li>If you installed the adapter to listen on a non-default port, update <code>5590</code> to the port number in use.</li>
<li>If you use a component ID other than <code>MQTT1</code>, update the endpoint with your chosen component ID.</li>
<li>For a list of other REST operations you can perform, like updating or deleting a data selection configuration, see <a href="#rest-urls">REST URLs</a>.
<br>
<br></li>
</ul>
</li>
</ol>
<h2 id="mqtt-data-selection-schema">MQTT data selection schema</h2>
<p>The full schema definition for the MQTT data selection configuration is in the <code>MQTT_DataSelection_schema.json</code> file located in one of the following folders:</p>
<ul>
<li>Windows: <code>%ProgramFiles%\OSIsoft\Adapters\MQTT\Schemas</code></li>
<li>Linux: <code>/opt/OSIsoft/Adapters/MQTT/Schemas</code></li>
</ul>
<h2 id="mqtt-data-selection-parameters">MQTT data selection parameters</h2>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Selected</strong></td>
<td>Optional</td>
<td><code>boolean</code></td>
<td>Selects or clears a measurement. To select an item, set the field to <code>true</code>. To remove an item, leave the field empty or set the value to <code>false</code>.  <br><br>Allowed value: <code>true</code> or <code>false</code><br>Default value: <code>true</code></td>
</tr>
<tr>
<td><strong>Name</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>The optional friendly name of the data item collected from the data source. <br><br>Allowed value: Any string<br>Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>StreamId</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>The custom stream Id that is used to create the streams. If you do not specify the StreamId, the adapter generates a default stream Id based on the DataSource parameter. For more information, see <a class="xref" href="data-source-generic.html#mqtt-data-source-parameters">PI Adapter for MQTT data source configuration</a>. A properly configured custom stream Id follows these rules: <br><br>Is not case-sensitive<br>Can contain spaces<br>Can contain front slashes (<code>/</code>)<br>Can contain a maximum of 100 characters<br>Cannot start with two underscores (<code>__</code>)<br>Cannot start or end with a period<br>Cannot contain consecutive periods<br>Cannot consist of only periods<br><br><br>The default Id automatically updates when there are changes to the measurement and follows the format of <code>&lt;Topic&gt;.&lt;MetricName&gt;</code>.<br><br>For more information on how the adapter encodes special characters in the <strong>StreamId</strong>, see <a class="xref" href="../main/shared-content/configuration/egress-endpoints.html#special-characters-encoding">Egress endpoints</a>.</td>
</tr>
<tr>
<td><strong>DataFilterId</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>The Id of the data filter. <br><br>Allowed value: Any string <br>Default value: <code>null</code><br><strong>Note:</strong> If the specified <strong>DataFilterId</strong> does not exist, unfiltered data is sent until that <strong>DataFilterId</strong> is created.</td>
</tr>
<tr>
<td><strong>Topic</strong></td>
<td>Required</td>
<td><code>string</code></td>
<td>The MQTT topic string.<br><br>Allowed value: Cannot be <code>null</code>, empty, or whitespace.</td>
</tr>
<tr>
<td><strong>ValueField</strong></td>
<td>Required</td>
<td><code>string</code></td>
<td>The JSONPath expression used to extract the data value from a property within the payload supplied by the MQTT server. A valid JSONPath expression starts with <code>$</code>. <sup>1</sup><br><br>Allowed value: Cannot be <code>null</code>, empty, or whitespace. For more information about JSONPath expression syntax, see <a class="xref" href="text-parser/jsonpath-syntax-for-value-retrieval.html">JSONPath syntax for value retrieval</a>.</td>
</tr>
<tr>
<td><strong>IndexField</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>The JSONPath expression to take value to use as a timestamp from a property. A valid JSONPath expression starts with <code>$</code>. For more information about JSONPath expression syntax, see <a class="xref" href="text-parser/jsonpath-syntax-for-value-retrieval.html">JSONPath syntax for value retrieval</a>. <sup>2</sup> <br><br><strong>Note:</strong> The adapter generates a timestamp when <code>null</code> is specified.<br><br>Allowed value: Any valid JSONPath expression</td>
</tr>
<tr>
<td><strong>IndexFormat</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>The time format of the timestamp value specified in the IndexField property. <sup>2</sup><br><br>Allowed value: Any string that can be used as a DateTime format in the .NET <code>DateTime.TryParseExact()</code>method, for example <code>01/30/2021</code>.<br> For more information, see <a href="https://docs.microsoft.com/en-us/dotnet/api/system.datetime.tryparseexact?view=net-5.0">DateTime.TryParseExact Method</a><br><br><strong>Note:</strong> If the string cannot be parsed, specify a custom DateTime string or one of the following keywords: <code>Adapter</code>, <code>UnixTimeSeconds</code>, <code>UnixTimeMilliseconds</code><br>Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>DataType</strong></td>
<td>Required</td>
<td><code>string</code></td>
<td>The expected data type of the values for the specified field.<br><br>Input MQTT data types are <code>Int16</code>, <code>Int32</code>, <code>Int64</code>, <code>UInt16</code>, <code>UInt32</code>, <code>UInt64</code>, <code>Float32</code>, <code>Float64</code>, <code>Boolean</code>, <code>String</code>, <code>Date-Time</code>.<br><br>Input MQTT complex data types are <code>Geolocation</code> and <code>Coordinates</code>.<br><br>For more information, see also <a class="xref" href="../overview/principles-of-operation.html#data-types">Principles of operation</a>.</td>
</tr>
<tr>
<td><strong>DataFields</strong></td>
<td>Required</td>
<td><code>dictionary&lt;string, string&gt;</code></td>
<td>A dictionary of values with key-value pairs. The keys are specific fields for a complex type and the values are the JSONPath expression used to extract the data value from a property within the payload supplied by the MQTT server. A valid JSONPath expression starts with <code>$</code>. <sup>1</sup> <br><br>Allowed keys: <code>Latitude</code>, <code>Longitude</code>, <code>x</code>, <code>y</code>, <code>z</code>. For more information about JSONPath expression syntax, see <a class="xref" href="text-parser/jsonpath-syntax-for-value-retrieval.html">JSONPath syntax for value retrieval</a>.<br>Default value: <code>null</code></td>
</tr>
</tbody>
</table>
<p><sup>1</sup> <strong>ValueField</strong> and <strong>DataFields</strong> are mutually exclusive. For example, if you specify <strong>ValueField</strong>, you cannot specify <strong>DataFields</strong> and vice versa.</p>
<p><sup>2</sup> If you do not specify <strong>IndexField</strong> and <strong>IndexFormat</strong>, the adapter automatically sets the latter to <code>Adapter</code>, which uses an adapter-supplied timestamp for the data. The timestamp is taken after the data is published to the adapter while the adapter processes it. If you specify <strong>IndexFormat</strong> only with a value other than <code>Adapter</code>, the validation fails and the adapter throws an error.</p>
<h3 id="csv-exportimport-with-complex-types">CSV export/import with complex types</h3>
<p><a href="https://docs.osisoft.com/bundle/edgecmd/page/index.html">EdgeCmd utility</a> supports the export and import of data selection with complex types, such as Geolocation and Coordinates. For example, the following command writes the data selection contents to a CSV file:</p>
<pre><code class="lang-cmd">edgecmd get DataSelection -cid MQTT1 -file &lt;fileName&gt;.csv -csv
</code></pre><p>After the CSV file is created, you can use <code>type &lt;fileName&gt;.csv</code> to display the contents of the file. The output will look similar to the following example in which the keywords are in the first line and the values, including complex types, are in the second line:</p>
<pre><code class="lang-cmd">topic,valueField,dataFields,indexField,dataType,indexFormat,selected,name,streamId,dataFilterId
mqtt/Boilers/Boiler1,,&quot;{&quot;&quot;X&quot;&quot;:&quot;&quot;.xValue]&quot;&quot;,&quot;&quot;Y&quot;&quot;:&quot;&quot;$.yValue&quot;&quot;,&quot;&quot;Z&quot;&quot;:&quot;&quot;$.zValue&quot;&quot;}&quot;,$[&#39;Timestamp&#39;],Coordinates,,True,,mqtt/Boilers/Boiler1.$.xValue.$.yValue.$.zValue,
</code></pre><h2 id="runtime-changes">Runtime changes</h2>
<p>When you create a new data selection item with a new <strong>Topic</strong> property, the adapter automatically subscribes the topic to the data source and starts data collection for the stream associated with the data selection item.  When you delete a data selection item, the adapter automatically stops collecting data for that item. Additionally, when you update a data selection item, the adapter updates the stream and continues data collection.</p>
<p><strong>Note:</strong> Runtime changes also handle validation of configuration, which means that an invalid data selection configuration is rejected.</p>
<h2 id="mqtt-data-selection-examples">MQTT data selection examples</h2>
<p>The following are examples of valid MQTT data selection configurations<sup>1</sup>:</p>
<h3 id="minimal-data-selection-configuration">Minimal data selection configuration</h3>
<pre><code class="lang-json">[
  {
    &quot;Topic&quot; : &quot;RandomTopic&quot;,
    &quot;ValueField&quot; : &quot;$.TestNode[:1].Value&quot;,
    &quot;DataType&quot; : &quot;uint64&quot;
  }
]
</code></pre><h3 id="complete-data-selection-configuration">Complete data selection configuration</h3>
<pre><code class="lang-json">[
  {
    &quot;Selected&quot; : true,
    &quot;Name&quot; : null,
    &quot;StreamId&quot; : &quot;RandomStreamId&quot;,
    &quot;DataFilterId&quot; : null,
    &quot;Topic&quot; : &quot;RandomTopic&quot;,
    &quot;ValueField&quot; : null,
    &quot;IndexField&quot; : &quot;$.Timestamp&quot;,
    &quot;IndexFormat&quot; : null,    
    &quot;DataType&quot; : &quot;Geolocation&quot;,
    &quot;DataFields&quot; : { &quot;Latitude&quot;: &quot;$.Float1&quot;, &quot;Longitude&quot;: &quot;$.Float2&quot; }
  },
  {
    &quot;Selected&quot; : true,
    &quot;Name&quot; : null,
    &quot;StreamId&quot; : &quot;RandomStreamId&quot;,
    &quot;DataFilterId&quot; : null,
    &quot;Topic&quot; : &quot;RandomTopic&quot;,
    &quot;ValueField&quot; : null,
    &quot;IndexField&quot; : &quot;$.Timestamp&quot;,
    &quot;IndexFormat&quot; : null,  
    &quot;DataType&quot; : &quot;Coordinates&quot;,
    &quot;DataFields&quot; : { &quot;x&quot;: &quot;$.Float4&quot;, &quot;y&quot;: &quot;$.Float5&quot;, &quot;z&quot;: &quot;$.Float6&quot; }
  }
]
</code></pre><p><sup>1</sup> <strong>Note:</strong> Both <strong>ValueField</strong> and <strong>IndexField</strong> require the correct structure of the JSON payload to be specified (in other words, what the data source returns). The previous examples use the following JSON payload structure:</p>
<pre><code class="lang-json">{
  &quot;TestNode&quot;: [
    {
      &quot;Time&quot;: &quot;02/17/2021 12:01:36 AM PST&quot;,
      &quot;Value&quot;: &quot;4578&quot;
    }
  ]
}
</code></pre><h2 id="rest-urls">REST URLs</h2>
<table>
<thead>
<tr>
<th>Relative URL</th>
<th>HTTP verb</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSelection</td>
<td><code>GET</code></td>
<td>Retrieves the MQTT data selection configuration, including all data selection items.</td>
</tr>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSelection</td>
<td><code>PUT</code></td>
<td>Configures or updates the MQTT data selection configuration. The adapter starts collecting data for each data selection item when the following conditions are met:<br><br>&bull; The MQTT data selection configuration <code>PUT</code> request is received.<br>&bull; A MQTT data source configuration is active.</td>
</tr>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSelection</td>
<td><code>DELETE</code></td>
<td>Deletes the active MQTT data selection configuration. The adapter stops collecting data.</td>
</tr>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSelection</td>
<td><code>PATCH</code></td>
<td>Allows partial updates of configured data selection items.<br><br><strong>Note:</strong> The request must be an array containing one or more data selection items. Each item in the array must include its <strong>StreamId</strong>.</td>
</tr>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSelection/&lt;StreamId></td>
<td><code>PUT</code></td>
<td>Updates or creates a new data selection item by <strong>StreamId</strong>. For new items, the adapter starts collecting data after the request is received.</td>
</tr>
<tr>
<td>api/v1/configuration/&lt;ComponentId>/DataSelection/&lt;StreamId></td>
<td><code>DELETE</code></td>
<td>Deletes a data selection item from the configuration by <strong>StreamId</strong>. The adapter stops collecting data for the deleted item.</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Replace <em>ComponentId</em> with the Id of your MQTT component. For example, <em>Mqtt1</em>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/PI-Adapter-MQTT-Docs/blob/main/content/configuration/data-selection-generic.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span><a href="https://www.osisoft.com/copyright/">© 2019 - 2021 OSIsoft, LLC. All rights reserved.</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
